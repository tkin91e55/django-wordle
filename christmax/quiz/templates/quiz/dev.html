{% extends 'quiz/base_quiz.html' %}
{% load i18n static %}

{% block title %}{% trans "Quiz Dev - Seeded Data" %}{% endblock %}

{% block extra_css %}
<!-- Prism.js adaptive theme (automatically switches with Bootstrap theme) -->
<link rel="stylesheet" href="{% static 'css/prism-adaptive.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="mb-4">{% trans "Quiz Development - Seeded Data" %}</h1>

    <p class="lead text-muted mb-4">
        {% trans "This page displays all seeded data with internationalization support." %}
        <br>
        {% trans "Current language" %}: <strong>{{ LANGUAGE_CODE }}</strong>
    </p>

    <!-- Statistics Overview -->
    <div class="row mb-5">
        <div class="col-md-3">
            <div class="card text-center bg-primary text-white">
                <div class="card-body">
                    <h2 class="mb-0">{{ categories.count }}</h2>
                    <p class="mb-0">{% trans "Categories" %}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-success text-white">
                <div class="card-body">
                    <h2 class="mb-0">{{ questions.count }}</h2>
                    <p class="mb-0">{% trans "Questions" %}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-warning text-dark">
                <div class="card-body">
                    <h2 class="mb-0">{{ trophies.count }}</h2>
                    <p class="mb-0">{% trans "Trophies" %}</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-info text-white">
                <div class="card-body">
                    <h2 class="mb-0">2</h2>
                    <p class="mb-0">{% trans "Languages" %}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Categories Section -->
    <section class="mb-5">
        <h2 class="mb-3">
            <i class="bi bi-folder"></i>
            {% trans "Categories" %} ({{ categories.count }})
        </h2>
        <div class="row g-3">
            {% for category in categories %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">
                            {% if category.icon_class %}
                            <i class="{{ category.icon_class }} fa-2x text-primary"></i>
                            {% endif %}
                            <span class="d-block mt-2">{{ category.get_name_display }}</span>
                        </h5>
                        <p class="card-text text-muted small">
                            <strong>{% trans "Code" %}:</strong> <code>{{ category.name }}</code><br>
                            <strong>{% trans "Icon" %}:</strong> <code>{{ category.icon_class }}</code><br>
                            <strong>{% trans "Questions" %}:</strong> <span class="badge bg-primary">{{ category.questions.count }}</span>
                        </p>
                        {% if category.description %}
                        <p class="card-text">{{ category.get_description }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Difficulty Levels Section -->
    <section class="mb-5">
        <h2 class="mb-3">
            <i class="bi bi-speedometer2"></i>
            {% trans "Difficulty Levels" %}
        </h2>
        <div class="row g-3">
            {% for value, label in difficulty_choices %}
            <div class="col-md-6 col-lg-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">{{ label }}</h5>
                        <p class="text-muted small mb-0">
                            <code>{{ value }}</code>
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Questions Section -->
    <section class="mb-5">
        <h2 class="mb-3">
            <i class="bi bi-question-circle"></i>
            {% trans "Questions" %} ({{ questions.count }})
        </h2>
        <div class="accordion" id="questionsAccordion">
            {% for question in questions %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading{{ question.id }}">
                    <button class="accordion-button collapsed" type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#collapse{{ question.id }}"
                            aria-expanded="false"
                            aria-controls="collapse{{ question.id }}">
                        <span class="badge bg-primary me-2">{{ question.category.get_name_display }}</span>
                        <span class="badge bg-secondary me-2">{{ question.get_difficulty_display }}</span>
                        <strong>{{ question.get_question_text|truncatewords:10 }}</strong>
                    </button>
                </h2>
                <div id="collapse{{ question.id }}"
                     class="accordion-collapse collapse"
                     aria-labelledby="heading{{ question.id }}"
                     data-bs-parent="#questionsAccordion">
                    <div class="accordion-body">
                        <!-- Question Text -->
                        <div class="mb-3">
                            <h6>{% trans "Question Text" %}:</h6>
                            <p>{{ question.get_question_text }}</p>
                        </div>

                        {% if question.code_snippet %}
                        <div class="mb-3">
                            <h6>{% trans "Code Snippet" %}:</h6>
                            <pre><code class="language-{{ question.prism_language|default:"markup" }}">{{ question.code_snippet }}</code></pre>
                        </div>
                        {% endif %}

                        <div class="mb-3">
                            <h6>{% trans "Answer" %}:</h6>
                            <p>
                                <code class="bg-success text-white px-3 py-2 rounded fs-5">{{ question.answer }}</code>
                                <span class="text-muted ms-2">({{ question.answer|length }} characters)</span>
                            </p>
                        </div>

                        <!-- Hint -->
                        {% if question.get_hint_text %}
                        <div class="mb-3">
                            <h6>{% trans "Hint" %}:</h6>
                            <p class="text-muted">{{ question.get_hint_text }}</p>
                        </div>
                        {% endif %}

                        <!-- Explanation -->
                        {% if question.get_explanation %}
                        <div class="mb-3">
                            <h6>{% trans "Explanation" %}:</h6>
                            <p>{{ question.get_explanation }}</p>
                        </div>
                        {% endif %}

                        <hr>
                        <div class="row text-muted small">
                            <div class="col-md-6">
                                <strong>{% trans "Category" %}:</strong> {{ question.category.get_name_display }}<br>
                                <strong>{% trans "Difficulty" %}:</strong> {{ question.get_difficulty_display }}<br>
                                {% if question.prism_language %}
                                <strong>{% trans "Syntax Highlighting" %}:</strong> <code>{{ question.prism_language }}</code><br>
                                {% endif %}
                                <strong>{% trans "Active" %}:</strong>
                                {% if question.is_active %}
                                    <span class="badge bg-success">{% trans "Yes" %}</span>
                                {% else %}
                                    <span class="badge bg-secondary">{% trans "No" %}</span>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <strong>{% trans "Created" %}:</strong> {{ question.created_at|date:"Y-m-d H:i" }}<br>
                                <strong>{% trans "Updated" %}:</strong> {{ question.updated_at|date:"Y-m-d H:i" }}
                            </div>
                        </div>

                        <!-- Show raw JSONField data for debugging -->
                        <hr>
                        <details class="mt-3">
                            <summary class="text-muted small" style="cursor: pointer;">
                                {% trans "Show raw JSON data" %}
                            </summary>
                            <div class="mt-2">
                                <h6 class="small">question_text:</h6>
                                <pre class="bg-light p-2 rounded small"><code>{{ question.question_text|safe }}</code></pre>

                                {% if question.hint_text %}
                                <h6 class="small">hint_text:</h6>
                                <pre class="bg-light p-2 rounded small"><code>{{ question.hint_text|safe }}</code></pre>
                                {% endif %}

                                {% if question.explanation %}
                                <h6 class="small">explanation:</h6>
                                <pre class="bg-light p-2 rounded small"><code>{{ question.explanation|safe }}</code></pre>
                                {% endif %}
                            </div>
                        </details>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Trophies Section -->
    <section class="mb-5">
        <h2 class="mb-3">
            <i class="bi bi-trophy"></i>
            {% trans "Trophies & Achievements" %} ({{ trophies.count }})
        </h2>
        <div class="row g-3">
            {% for trophy in trophies %}
            <div class="col-md-6 col-lg-4">
                <div class="card h-100">
                    <div class="card-body">
                        <div class="d-flex align-items-start">
                            <div class="flex-grow-1">
                                <h5 class="card-title">
                                    <i class="bi bi-trophy-fill text-warning"></i>
                                    {{ trophy.get_name }}
                                </h5>
                                <p class="card-text">{{ trophy.get_description }}</p>
                                <div class="small text-muted">
                                    <strong>{% trans "Code" %}:</strong> <code>{{ trophy.code }}</code><br>
                                    <strong>{% trans "Requirement" %}:</strong> <span class="badge bg-info">{{ trophy.get_requirement_type_display }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Language Switcher Notice -->
    <section class="alert alert-info">
        <h5 class="alert-heading">
            <i class="bi bi-info-circle"></i>
            {% trans "Testing i18n" %}
        </h5>
        <p class="mb-0">
            {% trans "Switch language using the navbar to see category names, difficulty levels, and UI text adapt to" %}
            <strong>EN</strong> / <strong>ZH</strong>.
        </p>
        <hr>
        <p class="mb-0 small">
            <strong>{% trans "English URL" %}:</strong> <code>/en/quiz/dev/</code><br>
            <strong>{% trans "Chinese URL" %}:</strong> <code>/zh/quiz/dev/</code>
        </p>
    </section>

</div>
{% endblock %}

{% block extra_js %}
<!-- Prism.js for code highlighting (dev page only) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
{% endblock %}
